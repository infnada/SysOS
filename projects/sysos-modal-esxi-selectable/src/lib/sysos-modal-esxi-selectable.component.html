<div class="modal-header">
  <div class="modal-title" id="modal-title">Select ESXi host</div>
  <div class="window__controls window__controls--right">
    <a class="window__close" ngbAutofocus (click)="activeModal.close(); $event.stopPropagation();">
      <i class="fa fa-close"></i>
    </a>
  </div>
</div>
<div class="modal-body modal-esxi-selectable" id="modal-body">
  <hr class="hr-text" data-content="Select an ESXi host">
  <mat-form-field class="w-100">
    <mat-label>Select a managed ESXi host</mat-label>
    <mat-select [(ngModel)]="selectedHost" (selectionChange)="checkESXidata()">
      <mat-option *ngFor="let host of ESXIHosts" [value]="host">
        {{host.host.host}} - {{host.host.name}}
      </mat-option>
    </mat-select>
  </mat-form-field>

  <ng-container *ngIf="finishLoading">
    <p>Looking for best suitable IP to connect with <strong>{{volume['volume-id-attributes'].name}}</strong> Snapshot.</p>

    <p *ngIf="foundIp === false">This ESXi host has no previous mounted Datastores from <strong>{{vserver['vserver-name']}}</strong>.</p>

    <p *ngIf="foundIp === false && sameSubnetIp.length === 0 && !selectedIface"><span class="text-danger">Can't find any good suitable IP to connect with</span>. Please choose one manually.</p>

    <ng-container *ngIf="selectedIface">
      <p>Will use <strong>{{selectedIface.address}}</strong> over <strong>{{selectedIface['data-protocols']['data-protocol']}}</strong> to connect with <strong>{{volume['volume-id-attributes'].name}}</strong> Snapshot.</p>
      <ul *ngIf="selectedIface['data-protocols']['data-protocol'] === 'nfs' && ifaceServiceData">
        <li>
          Version 3 Support <i class="fa" [ngClass]="ifaceServiceData['is-nfsv3-enabled'] === true ? 'fa-check text-success' : 'fa-close text-danger'"></i><br />
          <span *ngIf="ifaceServiceData['is-nfsv3-enabled'] === true && !checkFirewallNFS(3)" class="text-danger"><i class="fa fa-exclamation-triangle"></i> ESXi firewall rules will be permanently changed adding the selected storage IP.</span>
        </li>
        <li>
          Version 4.1 Support <i class="fa" [ngClass]="ifaceServiceData['is-nfsv41-enabled'] === true ? 'fa-check text-success' : 'fa-close text-danger'"></i><br />
          <span *ngIf="ifaceServiceData['is-nfsv41-enabled'] === true && !checkFirewallNFS(4)" class="text-danger"><i class="fa fa-exclamation-triangle"></i> ESXi firewall rules will be permanently changed adding the selected storage IP.</span>
        </li>
      </ul>
    </ng-container>

    <mat-slide-toggle class="mb-3" [(ngModel)]="manualIp" *ngIf="foundIfaces.length > 1 && forceManualIp === false">
      Choose different IP
    </mat-slide-toggle>

    <mat-form-field class="w-100" *ngIf="foundIfaces.length > 0 && manualIp === true">
      <mat-label>Select an IP to connect with Storage Volume</mat-label>
      <mat-select [(ngModel)]="selectedIface" (selectionChange)="checkIface()">
        <mat-option *ngFor="let iface of foundIfaces" [value]="iface">
          {{iface.address}} - {{iface['data-protocols']['data-protocol']}} - {{iface['interface-name']}}
        </mat-option>
      </mat-select>
    </mat-form-field>
  </ng-container>

</div>
<div class="modal-footer">
  <button class="btn btn-primary" type="button" (click)="activeModal.close()">Cancel</button>
  <button class="btn btn-default" type="button" (click)="activeModal.close({selectedHost: selectedHost, selectedIface: selectedIface})">Select</button>
</div>
